import { NextResponse } from "next/server";
import satori from "satori";
import sharp from "sharp";
import { join } from "path";
import * as fs from "fs";

const interRegPath = join(process.cwd(), "public/Inter-Regular.ttf");
let interReg = fs.readFileSync(interRegPath);

const interBoldPath = join(process.cwd(), "public/Inter-Bold.ttf");
let interBold = fs.readFileSync(interBoldPath);

export async function GET() {
  const svg = await satori(
    <div
      style={{
        display: "flex",
        flexDirection: "column",
        alignItems: "center",
        width: "100%",
        height: "100%",
        backgroundColor: "white",
        padding: 50,
        lineHeight: 1.2,
        fontSize: 24,
        color: "black",
        position: "relative", // Add this to allow absolute positioning of the image
      }}
    >
      <h1>What is your IP</h1>
      <div style={{ display: "flex" }}>Click to get your IP address</div>

      <svg
        style={{
          position: "absolute",
          bottom: 0, // Position at the bottom
          left: 0, // Position at the left
          width: "136", // Adjust the width as needed
          height: "51",
        }}
        viewBox="0 0 410 155"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M3.072 47V12.68H16.56C20.304 12.68 22.8 13.736 24.624 15.656C26.16 17.288 27.024 19.448 27.024 22.28C27.024 28.616 23.328 32.072 16.128 32.072H6.288V47H3.072ZM6.288 29.336H15.888C21.456 29.336 23.76 26.696 23.76 22.376C23.76 17.96 21.12 15.512 16.176 15.512H6.288V29.336ZM39.6263 45.128C45.1463 45.128 48.0263 40.424 48.0263 34.616C48.0263 28.808 45.1463 24.104 39.6263 24.104C34.0583 24.104 31.1783 28.808 31.1783 34.616C31.1783 40.424 34.0583 45.128 39.6263 45.128ZM39.6263 47.624C32.4743 47.624 28.1063 42.008 28.1063 34.616C28.1063 27.224 32.4743 21.608 39.6263 21.608C46.7783 21.608 51.0503 27.224 51.0503 34.616C51.0503 42.008 46.7783 47.624 39.6263 47.624ZM59.4814 47L52.0894 22.184H55.2094L59.5294 37.544C60.2014 39.992 61.1134 44.024 61.1134 44.024H61.2094C61.2094 44.024 62.1694 40.04 62.7934 37.784L67.0174 22.184H70.2334L74.3134 37.784C74.8894 40.04 75.8014 44.024 75.8014 44.024H75.8974C75.8974 44.024 76.9054 39.944 77.6254 37.544L82.2334 22.184H85.2574L77.4334 47H74.1694L69.8974 31.16C69.2734 28.808 68.6014 25.544 68.6014 25.544H68.5054C68.5054 25.544 67.8334 28.808 67.2094 31.16L62.8414 47H59.4814ZM97.7993 47.624C90.3593 47.624 86.2313 42.056 86.2313 34.616C86.2313 27.176 90.6953 21.608 97.5593 21.608C105.527 21.608 108.263 28.184 108.215 35.144H89.3033C89.4473 40.712 92.1353 45.08 97.7993 45.08C101.927 45.08 104.087 42.872 105.047 39.512H107.927C106.871 44.408 103.367 47.624 97.7993 47.624ZM89.3513 32.792H105.095C104.951 27.896 102.647 24.056 97.5593 24.056C92.5193 24.056 89.8793 27.848 89.3513 32.792ZM111.902 47V22.184H114.878V26.792H114.974C116.51 23.912 119.102 21.992 122.558 21.992C122.942 21.992 123.182 22.04 123.374 22.088V25.016C121.598 24.728 119.63 25.112 118.094 26.216C116.174 27.656 114.878 29.96 114.878 32.888V47H111.902ZM135.721 47.624C128.281 47.624 124.153 42.056 124.153 34.616C124.153 27.176 128.617 21.608 135.481 21.608C143.449 21.608 146.185 28.184 146.137 35.144H127.225C127.369 40.712 130.057 45.08 135.721 45.08C139.849 45.08 142.009 42.872 142.969 39.512H145.849C144.793 44.408 141.289 47.624 135.721 47.624ZM127.273 32.792H143.017C142.873 27.896 140.569 24.056 135.481 24.056C130.441 24.056 127.801 27.848 127.273 32.792ZM159.232 47.672C152.56 47.672 148.528 42.296 148.528 34.664C148.528 26.408 153.232 21.656 159.136 21.656C162.928 21.656 165.712 23.432 167.296 26.312H167.392V12.68H170.368V47H167.392V43.304H167.296C165.472 46.136 162.976 47.672 159.232 47.672ZM159.328 45.176C164.752 45.176 167.632 40.904 167.632 34.712C167.632 28.616 164.704 24.152 159.328 24.152C154.432 24.152 151.6 28.52 151.6 34.712C151.6 40.52 154.096 45.176 159.328 45.176ZM193.87 47.672C190.078 47.672 187.582 46.184 185.662 43.256H185.566V47H182.59V12.68H185.566V26.456H185.662C187.39 23.576 190.126 21.656 194.062 21.656C200.014 21.656 204.286 26.408 204.286 34.664C204.286 42.296 200.398 47.672 193.87 47.672ZM193.726 45.176C198.814 45.176 201.262 40.52 201.262 34.712C201.262 28.52 198.622 24.152 193.678 24.152C188.206 24.152 185.326 28.808 185.326 34.712C185.326 40.904 188.206 45.176 193.726 45.176ZM209.932 55.208C208.828 55.208 208.156 55.064 207.388 54.824V52.184H207.532C207.964 52.328 208.636 52.52 209.788 52.52C211.66 52.52 213.004 51.704 213.916 49.16L214.732 46.952L205.18 22.184H208.348L214.3 38.216C215.164 40.52 216.268 43.88 216.268 43.88H216.364C216.364 43.88 217.42 40.52 218.236 38.216L223.948 22.184H227.02L216.796 49.592C215.116 54.056 213.148 55.208 209.932 55.208Z"
          fill="black"
        />
        <path
          d="M78.8956 153.346V74.5088H94.0484V153.346H78.8956Z"
          fill="black"
        />
        <path
          d="M128.871 155C111.155 155 99.0108 141.989 99.0108 125.119C99.0108 108.249 111.155 95.2381 128.871 95.2381C146.586 95.2381 158.73 108.249 158.73 125.119C158.73 141.989 146.586 155 128.871 155ZM128.871 143.533C138.118 143.533 143.355 136.145 143.355 125.119C143.355 114.093 138.118 106.595 128.871 106.595C119.512 106.595 114.386 114.093 114.386 125.119C114.386 136.145 119.512 143.533 128.871 143.533Z"
          fill="black"
        />
        <path
          d="M190.063 155C172.014 155 160.76 141.989 160.76 125.119C160.76 108.249 171.902 95.2381 189.283 95.2381C204.102 95.2381 213.238 103.728 215.243 115.967H200.425C199.422 111.006 195.523 107.257 189.952 107.257C180.815 107.257 176.136 114.203 176.136 125.119C176.136 135.814 180.481 142.982 189.729 142.982C195.857 142.982 200.202 139.784 201.205 133.389H215.801C214.798 145.407 205.327 155 190.063 155Z"
          fill="black"
        />
        <path
          d="M257.841 153.346L241.796 127.545L235.223 134.271V153.346H220.181V74.5088H235.223V118.173L255.501 96.7817H273.662L252.604 118.283L276.224 153.346H257.841Z"
          fill="black"
        />
        <path
          d="M313.131 153.346C312.24 152.244 311.683 149.597 311.349 147.061H311.126C308.229 151.361 304.107 154.669 294.302 154.669C282.603 154.669 274.358 148.605 274.358 137.358C274.358 124.899 284.609 120.929 297.31 119.165C306.781 117.842 311.126 117.07 311.126 112.77C311.126 108.69 307.895 106.044 301.544 106.044C294.413 106.044 290.959 108.58 290.514 113.983H277.032C277.478 104.059 284.943 95.3483 301.655 95.3483C318.814 95.3483 325.722 102.956 325.722 116.188V144.966C325.722 149.266 326.39 151.802 327.727 152.795V153.346H313.131ZM297.979 144.194C306.669 144.194 311.46 138.902 311.46 133.389V124.899C308.786 126.442 304.664 127.324 300.875 128.206C292.965 129.971 289.065 131.735 289.065 137.027C289.065 142.32 292.631 144.194 297.979 144.194Z"
          fill="black"
        />
        <path
          d="M333.126 153.346V96.7817H348.279V153.346H333.126ZM333.126 87.9608V74.5088H348.279V87.9608H333.126Z"
          fill="black"
        />
        <path
          d="M377.207 155C362.834 155 353.029 143.423 353.029 125.119C353.029 107.477 363.168 95.2381 377.43 95.2381C385.452 95.2381 390.465 98.8767 393.585 103.618H393.919V74.5088H409.072V153.346H394.476V145.959H394.254C390.911 151.361 385.229 155 377.207 155ZM380.549 142.43C389.574 142.43 394.254 135.814 394.254 125.45C394.254 114.644 390.688 107.367 380.995 107.367C372.639 107.367 368.405 114.644 368.405 125.119C368.405 136.035 372.75 142.43 380.549 142.43Z"
          fill="black"
        />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M55.2044 87.3755H0.74975V74.526H55.2044C65.398 74.526 73.6617 82.7066 73.6617 92.7979C73.6617 102.889 65.398 111.07 55.2044 111.07H15.7137C14.2038 111.07 12.9798 112.281 12.9798 113.776C12.9798 115.271 14.2038 116.483 15.7137 116.483H55.206C65.3988 116.483 73.6617 124.663 73.6617 134.753C73.6617 144.843 65.3988 153.023 55.206 153.023H0.74975V140.174H55.206C58.2302 140.174 60.6818 137.747 60.6818 134.753C60.6818 131.759 58.2302 129.332 55.206 129.332H15.7137C7.03528 129.332 0 122.367 0 113.776C0 105.185 7.03528 98.2203 15.7137 98.2203H55.2044C58.2295 98.2203 60.6818 95.7926 60.6818 92.7979C60.6818 89.8032 58.2295 87.3755 55.2044 87.3755Z"
          fill="black"
        />
      </svg>
    </div>,
    {
      width: 600,
      height: 400,
      fonts: [
        {
          name: "Inter",
          data: interReg,
          weight: 400,
          style: "normal",
        },
        {
          name: "Inter",
          data: interBold,
          weight: 800,
          style: "normal",
        },
      ],
    }
  );

  const img = await sharp(Buffer.from(svg))
    .resize(1200)
    .toFormat("png")
    .toBuffer();
  return new NextResponse(img, {
    status: 200,
    headers: {
      "Content-Type": "image/png",
      "Cache-Control": "max-age=10",
    },
  });
}
